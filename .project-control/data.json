{
  "version": 1,
  "tasks": [
    {
      "id": "task_passive_income_plan",
      "title": "Review passive income requirements",
      "status": "done",
      "priority": "high",
      "description": "Confirm 12-month payout logic, regular-only payouts, and yield base without currency.",
      "checklist": [
        {
          "text": "Review dividend and coupon filters in backend",
          "done": true
        },
        {
          "text": "Review yield formula against non-currency base",
          "done": true
        }
      ],
      "links": [
        "src/routes.ts",
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_passive_income_impl",
      "title": "Align passive income calculations",
      "status": "done",
      "priority": "high",
      "description": "Apply backend and UI updates for passive income card values.",
      "checklist": [
        {
          "text": "Adjust backend fields and payout filters",
          "done": true
        },
        {
          "text": "Map and show values in UI",
          "done": true
        }
      ],
      "links": [
        "src/routes.ts",
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_donut_plan",
      "title": "Review donut rendering issues",
      "status": "done",
      "priority": "high",
      "description": "Find causes of pixelated look and tiny share visibility problems.",
      "checklist": [
        {
          "text": "Inspect donut CSS and conic-gradient logic",
          "done": true
        },
        {
          "text": "Inspect hover detection for tiny slices",
          "done": true
        }
      ],
      "links": [
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_donut_impl",
      "title": "Improve donut visuals and tiny shares",
      "status": "done",
      "priority": "high",
      "description": "Refine donut style and make very small shares visible and hoverable.",
      "checklist": [
        {
          "text": "Update donut visual style",
          "done": true
        },
        {
          "text": "Add tiny-slice visualization logic",
          "done": true
        }
      ],
      "links": [
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_passive_donut_verify",
      "title": "Verify final changes",
      "status": "done",
      "priority": "medium",
      "description": "Run tests and validate UI behavior after updates.",
      "checklist": [
        {
          "text": "Run npm test",
          "done": true
        },
        {
          "text": "Validate donut tiny-slice behavior in UI",
          "done": true
        }
      ],
      "links": [
        "package.json",
        "src/routes.ts",
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_runtime_referror_plan",
      "title": "Проверить причину ReferenceError в /api/portfolio",
      "status": "done",
      "priority": "high",
      "description": "Найти место, где используется несуществующая переменная passiveIncomeBaseValue.",
      "checklist": [
        {
          "text": "Прочитать блок формирования response в src/routes.ts",
          "done": true
        },
        {
          "text": "Подтвердить конфликт имен переменных",
          "done": true
        }
      ],
      "links": [
        "src/routes.ts"
      ]
    },
    {
      "id": "task_runtime_referror_impl",
      "title": "Исправить падение /api/portfolio",
      "status": "done",
      "priority": "high",
      "description": "Заменить неверную переменную на корректную в JSON ответе.",
      "checklist": [
        {
          "text": "Поправить имя переменной в src/routes.ts",
          "done": true
        },
        {
          "text": "Убедиться, что поле в response заполняется",
          "done": true
        }
      ],
      "links": [
        "src/routes.ts"
      ]
    },
    {
      "id": "task_runtime_referror_verify",
      "title": "Проверить исправление",
      "status": "done",
      "priority": "medium",
      "description": "Прогнать тесты и убедиться, что runtime-ошибка ушла.",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить логику /api/portfolio без падений",
          "done": true
        }
      ],
      "links": [
        "package.json",
        "src/routes.ts"
      ]
    },
    {
      "id": "task_donut_animation_plan",
      "title": "Проверить текущую анимацию бублика",
      "status": "done",
      "priority": "high",
      "description": "Определить, как сейчас отрисовываются сегменты и почему переход выглядит резким.",
      "checklist": [
        {
          "text": "Проверить applyDonut и buildDonutSlices",
          "done": true
        },
        {
          "text": "Выбрать модель плавной интерполяции сегментов",
          "done": true
        }
      ],
      "links": [
        "src/ui/homePage.ts"
      ]
    },
    {
      "id": "task_donut_animation_impl",
      "title": "Добавить плавную анимацию сегментов",
      "status": "done",
      "priority": "high",
      "description": "Реализовать плавный переход углов сегментов при обновлении данных.",
      "checklist": [
        {
          "text": "Добавить requestAnimationFrame-анимацию для сегментов",
          "done": true
        },
        {
          "text": "Синхронизировать hover/tooltip с анимированными срезами",
          "done": true
        }
      ],
      "links": [
        "src/ui/homePage.ts"
      ],
      "updatedAt": "2026-02-12T20:21:20.447Z"
    },
    {
      "id": "task_donut_animation_verify",
      "title": "Проверить анимацию бублика",
      "status": "done",
      "priority": "medium",
      "description": "Прогнать тесты и убедиться, что анимация работает без регрессий.",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить плавность и корректность hover на малых долях",
          "done": true
        }
      ],
      "links": [
        "package.json",
        "src/ui/homePage.ts"
      ],
      "updatedAt": "2026-02-12T20:21:20.447Z"
    },
    {
      "id": "task_daily_movers_plan",
      "title": "Разобрать отсутствие данных за день",
      "description": "Понять, почему блоки роста/падения за день пустые и зависит ли это от закрытой биржи.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Проверить расчет dayPriceAvailable/dayChangePct в routes",
          "done": true
        },
        {
          "text": "Проверить фильтрацию movers на UI",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:22:53.013Z",
      "updatedAt": "2026-02-12T20:25:53.734Z"
    },
    {
      "id": "task_daily_movers_fix",
      "title": "Исправить расчет данных за день",
      "description": "Обеспечить показ топов за день при закрытой бирже по последним доступным котировкам.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Скорректировать условия hasDayPrices и fallback цен",
          "done": true
        },
        {
          "text": "Проверить, что заблокированные позиции не ломают топы",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:22:53.013Z",
      "updatedAt": "2026-02-12T20:27:28.100Z"
    },
    {
      "id": "task_daily_movers_verify",
      "title": "Проверить корректность после фикса",
      "description": "Подтвердить тестами и ручной проверкой, что топы роста/падения формируются.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить структуру ответа /api/portfolio",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:22:53.013Z",
      "updatedAt": "2026-02-12T20:27:28.100Z"
    },
    {
      "id": "task_analytics_ui_plan",
      "title": "Проанализировать баги аналитики",
      "description": "Проанализировать, как на аналитике добавить верхние подпункты и вынести 4 KPI-блока как на главной, включая блок валюты.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Проверить текущие табы в analyticsPage и точки встраивания",
          "done": true
        },
        {
          "text": "Сопоставить поля /api/analytics для KPI и валюты",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:28:18.813Z",
      "updatedAt": "2026-02-12T20:30:14.076Z"
    },
    {
      "id": "task_analytics_ui_fix",
      "title": "Исправить UI аналитики",
      "description": "Реализовать верхние подпункты аналитики, 4 KPI-блока как на главной и отображение суммы валюты без смены цветовой схемы.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Добавить верхнюю под-навигацию как в макете",
          "done": true
        },
        {
          "text": "Перенести 4 KPI-блока и заполнение реальными данными",
          "done": true
        },
        {
          "text": "Добавить блок Валюта по данным analytics assetBreakdown",
          "done": true
        },
        {
          "text": "Закрыть панель токена по умолчанию",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:28:18.813Z",
      "updatedAt": "2026-02-12T20:34:41.310Z"
    },
    {
      "id": "task_analytics_ui_verify",
      "title": "Проверить после правок",
      "description": "Проверить корректность верстки и данных после изменений аналитики.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить, что KPI и вкладки не используют демо-значения",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:28:18.813Z",
      "updatedAt": "2026-02-12T20:34:41.310Z"
    },
    {
      "id": "task_movers_empty_plan",
      "title": "Разобрать пустые топы роста/падения",
      "description": "Проверить, почему блоки top movers остаются пустыми при загруженных данных портфеля.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Проверить buildMovers и фильтры на UI",
          "done": true
        },
        {
          "text": "Проверить поля dayChange на ответе /api/portfolio",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:41:12.878Z",
      "updatedAt": "2026-02-12T20:41:35.634Z"
    },
    {
      "id": "task_movers_empty_fix",
      "title": "Исправить формирование top movers",
      "description": "Скорректировать алгоритм формирования топов, чтобы данные отображались стабильно.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Добавить fallback-логику при нулевых/нейтральных изменениях",
          "done": true
        },
        {
          "text": "Сохранить корректную сортировку роста и падений",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:41:12.878Z",
      "updatedAt": "2026-02-12T20:43:08.525Z"
    },
    {
      "id": "task_movers_empty_verify",
      "title": "Проверить после фикса",
      "description": "Подтвердить отсутствие регрессий и корректность отображения.",
      "status": "done",
      "priority": "high",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить, что списки не пустые при валидных данных",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:41:12.878Z",
      "updatedAt": "2026-02-12T20:43:08.525Z"
    },
    {
      "id": "task_analytics_intro_hide_plan",
      "title": "Уточнить удаляемый блок на аналитике",
      "description": "Убрать верхний блок с заголовком и сервисной панелью, выделенный красной рамкой.",
      "status": "done",
      "priority": "medium",
      "checklist": [
        {
          "text": "Проверить разметку блока в analyticsPage",
          "done": true
        },
        {
          "text": "Выбрать безопасный способ скрытия без поломки JS",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:43:57.585Z",
      "updatedAt": "2026-02-12T20:44:37.511Z"
    },
    {
      "id": "task_analytics_intro_hide_fix",
      "title": "Скрыть верхний блок аналитики",
      "description": "Сделать так, чтобы выделенный верхний блок не отображался пользователю.",
      "status": "done",
      "priority": "medium",
      "checklist": [
        {
          "text": "Скрыть заголовок/подзаголовок аналитики",
          "done": true
        },
        {
          "text": "Скрыть утилитарную панель с кнопками и статусом",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:43:57.585Z",
      "updatedAt": "2026-02-12T20:44:37.511Z"
    },
    {
      "id": "task_analytics_intro_hide_verify",
      "title": "Проверить изменения",
      "description": "Убедиться, что аналитика работает и лишний блок не отображается.",
      "status": "done",
      "priority": "medium",
      "checklist": [
        {
          "text": "Запустить npm test",
          "done": true
        },
        {
          "text": "Проверить отсутствие регрессий в JS",
          "done": true
        }
      ],
      "createdAt": "2026-02-12T20:43:57.585Z",
      "updatedAt": "2026-02-12T20:44:37.511Z"
    }
  ],
  "docMarkdown": "# Project Notes\\n\\n",
  "activity": [
    {
      "id": "act_donut_animation_impl_1770927606010",
      "type": "note",
      "message": "In progress: requestAnimationFrame transition added for donut segment updates.",
      "ts": 1770927606010,
      "taskId": "task_donut_animation_impl"
    },
    {
      "id": "act_donut_animation_start_1770927538188",
      "type": "note",
      "message": "In progress: refining donut segment transition animation.",
      "ts": 1770927538188,
      "taskId": "task_donut_animation_plan"
    },
    {
      "id": "act_runtime_referror_done_1770927466383",
      "type": "note",
      "message": "Done: ReferenceError resolved and test suite passed.",
      "ts": 1770927466383,
      "taskId": "task_runtime_referror_verify"
    },
    {
      "id": "act_runtime_referror_impl_1770927445487",
      "type": "note",
      "message": "In progress: patched response field mapping for passive income base value.",
      "ts": 1770927445487,
      "taskId": "task_runtime_referror_impl"
    },
    {
      "id": "act_runtime_referror_start_1770927430941",
      "type": "note",
      "message": "In progress: fixing passiveIncomeBaseValue ReferenceError in routes response.",
      "ts": 1770927430941,
      "taskId": "task_runtime_referror_plan"
    },
    {
      "id": "act_passive_donut_done_1770927315708",
      "type": "note",
      "message": "Done: passive income and donut updates verified with test suite.",
      "ts": 1770927315708,
      "taskId": "task_passive_donut_verify"
    },
    {
      "id": "act_donut_impl_1770927271235",
      "type": "note",
      "message": "In progress: improved donut rendering and tiny-slice handling.",
      "ts": 1770927271235,
      "taskId": "task_donut_impl"
    },
    {
      "id": "act_passive_income_done_1770927271234",
      "type": "note",
      "message": "Done: passive income values aligned with current backend fields and UI mapping.",
      "ts": 1770927271234,
      "taskId": "task_passive_income_impl"
    },
    {
      "id": "act_donut_animation_verify_start_1770927680447",
      "type": "status_change",
      "message": "Взял задачу верификации: запускаю тесты и проверяю анимацию бублика.",
      "createdAt": "2026-02-12T20:21:20.447Z",
      "taskId": "task_donut_animation_verify"
    },
    {
      "id": "act_donut_animation_verify_done_1770927680448",
      "type": "status_change",
      "message": "Верификация завершена: npm test прошел, анимация бублика и синхронизация hover применены.",
      "createdAt": "2026-02-12T20:21:20.447Z",
      "taskId": "task_donut_animation_verify"
    },
    {
      "id": "act_daily_movers_start_1770927773014",
      "type": "status_change",
      "message": "План: анализирую, почему нет данных по росту/падению за день.",
      "createdAt": "2026-02-12T20:22:53.013Z",
      "taskId": "task_daily_movers_plan"
    },
    {
      "id": "act_daily_movers_plan_done_1770927953735",
      "type": "status_change",
      "message": "Анализ завершен: отсутствие данных вызвано строгой зависимостью от пары last/close price.",
      "createdAt": "2026-02-12T20:25:53.734Z",
      "taskId": "task_daily_movers_plan"
    },
    {
      "id": "act_daily_movers_fix_start_1770927953736",
      "type": "status_change",
      "message": "Начал реализацию fallback на дневные свечи для расчета изменений за день.",
      "createdAt": "2026-02-12T20:25:53.734Z",
      "taskId": "task_daily_movers_fix"
    },
    {
      "id": "act_daily_movers_fix_done_1770928048101",
      "type": "status_change",
      "message": "Фикс выполнен: добавлен fallback на дневные свечи и привязка цен по instrument_uid/figi.",
      "createdAt": "2026-02-12T20:27:28.100Z",
      "taskId": "task_daily_movers_fix"
    },
    {
      "id": "act_daily_movers_verify_done_1770928048102",
      "type": "status_change",
      "message": "Проверка завершена: npm test успешно, сценарий без close_prices покрыт тестом.",
      "createdAt": "2026-02-12T20:27:28.100Z",
      "taskId": "task_daily_movers_verify"
    },
    {
      "id": "act_analytics_ui_start_1770928098813",
      "type": "status_change",
      "message": "План: анализирую автoраскрытие панели токена и разницу в размере шрифта на аналитике.",
      "createdAt": "2026-02-12T20:28:18.813Z",
      "taskId": "task_analytics_ui_plan"
    },
    {
      "id": "act_analytics_scope_update_1770928214077",
      "type": "status_change",
      "message": "Обновил план под новый запрос: подпункты сверху, 4 KPI-блока, валюта и поведение токен-панели.",
      "createdAt": "2026-02-12T20:30:14.076Z",
      "taskId": "task_analytics_ui_fix"
    },
    {
      "id": "act_analytics_ui_fix_done_1770928481311",
      "type": "status_change",
      "message": "Реализация завершена: добавлены подпункты, KPI-блоки и строка валюты на аналитике.",
      "createdAt": "2026-02-12T20:34:41.310Z",
      "taskId": "task_analytics_ui_fix"
    },
    {
      "id": "act_analytics_ui_verify_done_1770928481312",
      "type": "status_change",
      "message": "Проверка завершена: npm test прошел успешно, данные берутся из /api/analytics.",
      "createdAt": "2026-02-12T20:34:41.310Z",
      "taskId": "task_analytics_ui_verify"
    },
    {
      "id": "act_movers_empty_start_1770928872878",
      "type": "status_change",
      "message": "План: анализирую, почему пустуют блоки топ роста/падения.",
      "createdAt": "2026-02-12T20:41:12.878Z",
      "taskId": "task_movers_empty_plan"
    },
    {
      "id": "act_movers_empty_plan_done_1770928895634",
      "type": "status_change",
      "message": "Анализ завершен: пустота списков вызвана слишком жесткой фильтрацией и отсечением нулевых изменений.",
      "createdAt": "2026-02-12T20:41:35.634Z",
      "taskId": "task_movers_empty_plan"
    },
    {
      "id": "act_movers_empty_fix_start_1770928895635",
      "type": "status_change",
      "message": "Начал фикс логики buildMovers для стабильного заполнения топов.",
      "createdAt": "2026-02-12T20:41:35.634Z",
      "taskId": "task_movers_empty_fix"
    },
    {
      "id": "act_movers_empty_fix_done_1770928988525",
      "type": "status_change",
      "message": "Фикс выполнен: buildMovers теперь использует fallback от цен и не обнуляет списки при нейтральном дне.",
      "createdAt": "2026-02-12T20:43:08.525Z",
      "taskId": "task_movers_empty_fix"
    },
    {
      "id": "act_movers_empty_verify_done_1770928988526",
      "type": "status_change",
      "message": "Проверка завершена: npm test успешен, логика топов обновлена.",
      "createdAt": "2026-02-12T20:43:08.525Z",
      "taskId": "task_movers_empty_verify"
    },
    {
      "id": "act_analytics_intro_hide_start_1770929037585",
      "type": "status_change",
      "message": "План: убираю верхний блок аналитики, выделенный на скриншоте.",
      "createdAt": "2026-02-12T20:43:57.585Z",
      "taskId": "task_analytics_intro_hide_plan"
    },
    {
      "id": "act_analytics_intro_hide_done_1770929077512",
      "type": "status_change",
      "message": "Скрыт верхний блок аналитики (заголовок, подзаголовок и сервисная панель). Тесты пройдены.",
      "createdAt": "2026-02-12T20:44:37.511Z",
      "taskId": "task_analytics_intro_hide_verify"
    }
  ]
}
